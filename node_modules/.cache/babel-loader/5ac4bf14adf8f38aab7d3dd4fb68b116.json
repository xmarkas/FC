{"ast":null,"code":"import _regeneratorRuntime from\"C:\\\\Users\\\\xmark\\\\Desktop\\\\Code\\\\Servers\\\\Qumoc\\\\food-commune\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/regenerator\";import _asyncToGenerator from\"C:\\\\Users\\\\xmark\\\\Desktop\\\\Code\\\\Servers\\\\Qumoc\\\\food-commune\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/asyncToGenerator\";var _this=this;/**\r\n * File:        okta.js\r\n * \r\n * Description: \r\n */console.log(\"running auth client..\");//  Okta browser SDK AuthClient\nvar config={issuer:\"https://dev-236245.okta.com/oauth2/default\",clientId:\"0oa4lqivbsKPbAtfs4x6\",redirectUri:\"https://qumoc.com/foodcommune\",responseMode:\"fragment\",tokenManager:{storage:\"sessionStorage\"},onSessionExpired:function onSessionExpired(){console.log(\"re-authorization is required\");// authClient.getWithRedirect();\n}};// AUTH CLIENT\nvar authClient=new window.OktaAuth(config);export var session=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var session,checkSession;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.next=2;return authClient.session.exists();case 2:session=_context.sent;checkSession=session.then(function(resolved){console.log('OKTA SESSION',resolved);return resolved;}).catch(function(err){console.log(err);});return _context.abrupt(\"return\",checkSession);case 5:case\"end\":return _context.stop();}}},_callee);}));return function session(){return _ref.apply(this,arguments);};}();export var getToken=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(session){var user,options,_options;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:if(!session){_context2.next=9;break;}_this.setState({session:true});_context2.next=4;return authClient.session.get();case 4:user=_context2.sent;// $(\"#user\").html(user.login);\n// Request token for API access\noptions={method:\"POST\",mode:\"same-origin\",credentials:\"same-origin\",headers:{\"Content-Type\":\"application/json\"},body:JSON.stringify({entity:{login:user.login,request:\"test\"}})};fetch(\"/foodcommune/secure\",options).then(function(res){if(res)return res.json();}).then(function(res){if(res.success){if(_this.props.setToken)_this.props.setToken(res.token);if(_this.props.setUser)_this.props.setUser(res.user);_this.setState({username:res.user.first_name});}}).then(function(){if(_this.props.viewData)_this.props.viewData();}).catch(function(err){console.log(err);});_context2.next=11;break;case 9://     this.setState({ session: false });\n//     console.log(window.location.href)\n//   If signed out and not on home page redirect\n//   if (window.location.href !== \"/foodcommune/\") {\n// setTimeout(function() {\n//   window.location.replace(\"/foodcommune\");\n// }, 1);\n//   }\n// Get provisional site access\n_options={method:\"POST\",mode:\"same-origin\",credentials:\"same-origin\",headers:{\"Content-Type\":\"application/json\"},body:JSON.stringify({access:_this.state.provisional})};fetch(\"/foodcommune/secure/provisional\",_options).then(function(res){return res.json();}).then(function(res){_this.setState({provisional:res.token});_this.props.updateParentState({provisional:res.token});}).catch(function(err){console.log(err);});case 11:case\"end\":return _context2.stop();}}},_callee2);}));return function getToken(_x){return _ref2.apply(this,arguments);};}();","map":{"version":3,"sources":["C:/Users/xmark/Desktop/Code/Servers/Qumoc/food-commune/src/util/okta.js"],"names":["console","log","config","issuer","clientId","redirectUri","responseMode","tokenManager","storage","onSessionExpired","authClient","window","OktaAuth","session","exists","checkSession","then","resolved","catch","err","getToken","setState","get","user","options","method","mode","credentials","headers","body","JSON","stringify","entity","login","request","fetch","res","json","success","props","setToken","token","setUser","username","first_name","viewData","access","state","provisional","updateParentState"],"mappings":"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","sourcesContent":["/**\r\n * File:        okta.js\r\n * \r\n * Description: \r\n */\r\nconsole.log(\"running auth client..\");\r\n//  Okta browser SDK AuthClient\r\nvar config = {\r\n    issuer: \"https://dev-236245.okta.com/oauth2/default\",\r\n    clientId: \"0oa4lqivbsKPbAtfs4x6\",\r\n    redirectUri: \"https://qumoc.com/foodcommune\",\r\n    responseMode: \"fragment\",\r\n    tokenManager: {\r\n        storage: \"sessionStorage\"\r\n    },\r\n    onSessionExpired: function () {\r\n        console.log(\"re-authorization is required\");\r\n        // authClient.getWithRedirect();\r\n    }\r\n};\r\n\r\n// AUTH CLIENT\r\nlet authClient = new window.OktaAuth(config);\r\n\r\nexport const session = async () => {\r\n    // let authClient = this.state.authClient;\r\n    let session = await authClient.session.exists();\r\n    let checkSession = session\r\n        .then(resolved => {\r\n            console.log('OKTA SESSION', resolved);\r\n            return resolved;\r\n        })\r\n        .catch(err => {\r\n            console.log(err);\r\n        })\r\n    \r\n    return checkSession;\r\n}\r\n\r\nexport const getToken = async (session) => {\r\n    // Check for user session\r\n    if (session) {\r\n        this.setState({ session: true });\r\n        let user = await authClient.session.get();\r\n        // $(\"#user\").html(user.login);\r\n\r\n        // Request token for API access\r\n        let options = {\r\n            method: \"POST\",\r\n            mode: \"same-origin\",\r\n            credentials: \"same-origin\",\r\n            headers: {\r\n                \"Content-Type\": \"application/json\"\r\n            },\r\n            body: JSON.stringify({ entity: { login: user.login, request: \"test\" } })\r\n        };\r\n\r\n        fetch(\"/foodcommune/secure\", options)\r\n            .then(res => {\r\n                if (res) return res.json();\r\n            })\r\n            .then(res => {\r\n                if (res.success) {\r\n                    if (this.props.setToken) this.props.setToken(res.token);\r\n                    if (this.props.setUser) this.props.setUser(res.user);\r\n                    this.setState({ username: res.user.first_name });\r\n                }\r\n            })\r\n            .then(() => {\r\n                if (this.props.viewData) this.props.viewData();\r\n            })\r\n            .catch(err => {\r\n                console.log(err);\r\n            });\r\n    } else {\r\n        //     this.setState({ session: false });\r\n        //     console.log(window.location.href)\r\n        //   If signed out and not on home page redirect\r\n        //   if (window.location.href !== \"/foodcommune/\") {\r\n        // setTimeout(function() {\r\n        //   window.location.replace(\"/foodcommune\");\r\n        // }, 1);\r\n        //   }\r\n\r\n        // Get provisional site access\r\n        let options = {\r\n            method: \"POST\",\r\n            mode: \"same-origin\",\r\n            credentials: \"same-origin\",\r\n            headers: {\r\n                \"Content-Type\": \"application/json\"\r\n            },\r\n            body: JSON.stringify({ access: this.state.provisional })\r\n        };\r\n        fetch(\"/foodcommune/secure/provisional\", options)\r\n            .then(res => {\r\n                return res.json();\r\n            })\r\n            .then(res => {\r\n                this.setState({ provisional: res.token });\r\n                this.props.updateParentState({ provisional: res.token });\r\n            })\r\n            .catch(err => {\r\n                console.log(err)\r\n            })\r\n    }\r\n};"]},"metadata":{},"sourceType":"module"}