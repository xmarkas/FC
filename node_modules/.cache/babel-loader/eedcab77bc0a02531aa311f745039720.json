{"ast":null,"code":"import _defineProperty from\"C:\\\\Users\\\\xmark\\\\Desktop\\\\Code\\\\Servers\\\\Qumoc\\\\food-commune\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/defineProperty\";import _regeneratorRuntime from\"C:\\\\Users\\\\xmark\\\\Desktop\\\\Code\\\\Servers\\\\Qumoc\\\\food-commune\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/regenerator\";import _asyncToGenerator from\"C:\\\\Users\\\\xmark\\\\Desktop\\\\Code\\\\Servers\\\\Qumoc\\\\food-commune\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/asyncToGenerator\";import _classCallCheck from\"C:\\\\Users\\\\xmark\\\\Desktop\\\\Code\\\\Servers\\\\Qumoc\\\\food-commune\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/classCallCheck\";import _createClass from\"C:\\\\Users\\\\xmark\\\\Desktop\\\\Code\\\\Servers\\\\Qumoc\\\\food-commune\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/createClass\";import _inherits from\"C:\\\\Users\\\\xmark\\\\Desktop\\\\Code\\\\Servers\\\\Qumoc\\\\food-commune\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/inherits\";import _createSuper from\"C:\\\\Users\\\\xmark\\\\Desktop\\\\Code\\\\Servers\\\\Qumoc\\\\food-commune\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/createSuper\";import React,{Component}from\"react\";var UserStatus=/*#__PURE__*/function(_Component){_inherits(UserStatus,_Component);var _super=_createSuper(UserStatus);function UserStatus(props){var _this$state;var _this;_classCallCheck(this,UserStatus);_this=_super.call(this,props);_this.state={};_this.userMenu=function(){console.log(\"clicked\");_this.setState({userMenu:_this.state.userMenu?false:true});};_this.newAuthClient=function(){console.log(\"running auth client..\");//  Okta browser SDK AuthClient\nvar config={issuer:\"https://dev-236245.okta.com/oauth2/default\",clientId:\"0oa4lqivbsKPbAtfs4x6\",redirectUri:\"https://qumoc.com/foodcommune\",responseMode:\"fragment\",tokenManager:{storage:\"sessionStorage\"},onSessionExpired:function onSessionExpired(){console.log(\"re-authorization is required\");// authClient.getWithRedirect();\n}};// AUTH CLIENT\nvar auth=new window.OktaAuth(config);_this.props.updateParentState({authClient:auth});return auth;};_this.session=/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var authClient,session,user,options,_options;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:authClient=_this.state.authClient;_context.next=3;return authClient.session.exists();case 3:session=_context.sent;if(!session){_context.next=13;break;}_this.setState({session:true});_context.next=8;return authClient.session.get();case 8:user=_context.sent;// $(\"#user\").html(user.login);\n// Request token for API access\noptions={method:\"POST\",mode:\"same-origin\",credentials:\"same-origin\",headers:{\"Content-Type\":\"application/json\"},body:JSON.stringify({entity:{login:user.login,request:\"test\"}})};fetch(\"/foodcommune/secure\",options).then(function(res){if(res)return res.json();}).then(function(res){if(res.success){if(_this.props.setToken)_this.props.setToken(res.token);if(_this.props.setUser)_this.props.setUser(res.user);_this.setState({username:res.user.first_name});}}).then(function(){if(_this.props.viewData)_this.props.viewData();}).catch(function(err){console.log(err);});_context.next=15;break;case 13://     this.setState({ session: false });\n//     console.log(window.location.href)\n//   If signed out and not on home page redirect\n//   if (window.location.href !== \"/foodcommune/\") {\n// setTimeout(function() {\n//   window.location.replace(\"/foodcommune\");\n// }, 1);\n//   }\n// Get provisional site access\n_options={method:\"POST\",mode:\"same-origin\",credentials:\"same-origin\",headers:{\"Content-Type\":\"application/json\"},body:JSON.stringify({access:_this.state.provisional})};fetch(\"/foodcommune/secure/provisional\",_options).then(function(res){return res.json();}).then(function(res){_this.setState({provisional:res.token});_this.props.updateParentState({provisional:res.token});}).catch(function(err){console.log(err);});case 15:case\"end\":return _context.stop();}}},_callee);}));_this.state=(_this$state={provisional:null,userMenu:false,// Toggle for user meny\nauthClient:_this.newAuthClient(),session:false},_defineProperty(_this$state,\"provisional\",null),_defineProperty(_this$state,\"username\",\"\"),_this$state);return _this;}_createClass(UserStatus,[{key:\"componentDidMount\",value:function componentDidMount(){this.session();}},{key:\"render\",value:function render(){var _this2=this;return/*#__PURE__*/React.createElement(React.Fragment,null,!this.state.session&&/*#__PURE__*/React.createElement(React.Fragment,null,/*#__PURE__*/React.createElement(\"span\",{id:\"open-account\",className:\"nav-item nav-link\",onClick:this.props.createAccount},\"Create Account\"),/*#__PURE__*/React.createElement(\"span\",{id:\"open-signin\",className:\"nav-item nav-link\",onClick:this.props.signIn},\"Sign In\")),this.state.session&&/*#__PURE__*/React.createElement(\"div\",null,/*#__PURE__*/React.createElement(\"div\",{onClick:this.userMenu,style:{display:\"flex\",alignItems:\"center\",position:\"relative\"}},/*#__PURE__*/React.createElement(\"i\",{className:\"fas fa-user-circle fa-2x mr-1 fc-green\"}),/*#__PURE__*/React.createElement(\"span\",{id:\"user\",style:{color:\"dimgray\"}},this.state.username),/*#__PURE__*/React.createElement(\"i\",{className:\"fas fa-caret-down ml-3\"}),this.state.userMenu&&/*#__PURE__*/React.createElement(\"div\",{id:\"user-menu\"},/*#__PURE__*/React.createElement(\"ul\",{style:{listStyle:\"none\",padding:\"10px\"}},/*#__PURE__*/React.createElement(\"li\",{style:{cursor:\"pointer\"},onClick:function onClick(){return _this2.state.authClient.signOut();}},\"Sign Out\"),/*#__PURE__*/React.createElement(\"li\",{style:{cursor:\"pointer\"},onClick:function onClick(){return window.location.href=\"/foodcommune/mydashboard.html\";}},\"Dashboard\"),/*#__PURE__*/React.createElement(\"li\",{style:{cursor:\"pointer\"}},\"Settings\"))))));}}]);return UserStatus;}(Component);export default UserStatus;","map":{"version":3,"sources":["C:/Users/xmark/Desktop/Code/Servers/Qumoc/food-commune/src/components/UserStatus.jsx"],"names":["React","Component","UserStatus","props","state","userMenu","console","log","setState","newAuthClient","config","issuer","clientId","redirectUri","responseMode","tokenManager","storage","onSessionExpired","auth","window","OktaAuth","updateParentState","authClient","session","exists","get","user","options","method","mode","credentials","headers","body","JSON","stringify","entity","login","request","fetch","then","res","json","success","setToken","token","setUser","username","first_name","viewData","catch","err","access","provisional","createAccount","signIn","display","alignItems","position","color","listStyle","padding","cursor","signOut","location","href"],"mappings":"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","sourcesContent":["import React, { Component } from \"react\";\r\n\r\nclass UserStatus extends Component {\r\n  state = {};\r\n  constructor(props) {\r\n    super(props);\r\n    this.state = {\r\n      provisional: null,\r\n      userMenu: false, // Toggle for user meny\r\n      authClient: this.newAuthClient(),\r\n      session: false,\r\n      provisional: null,\r\n      username: \"\"\r\n    };\r\n  }\r\n\r\n  componentDidMount() {\r\n    this.session();\r\n  }\r\n\r\n  userMenu = () => {\r\n    console.log(\"clicked\");\r\n    this.setState({ userMenu: this.state.userMenu ? false : true });\r\n  };\r\n\r\n  newAuthClient = () => {\r\n    console.log(\"running auth client..\");\r\n    //  Okta browser SDK AuthClient\r\n    var config = {\r\n      issuer: \"https://dev-236245.okta.com/oauth2/default\",\r\n      clientId: \"0oa4lqivbsKPbAtfs4x6\",\r\n      redirectUri: \"https://qumoc.com/foodcommune\",\r\n      responseMode: \"fragment\",\r\n      tokenManager: {\r\n        storage: \"sessionStorage\"\r\n      },\r\n      onSessionExpired: function() {\r\n        console.log(\"re-authorization is required\");\r\n        // authClient.getWithRedirect();\r\n      }\r\n    };\r\n\r\n    // AUTH CLIENT\r\n    let auth = new window.OktaAuth(config);\r\n    this.props.updateParentState({ authClient: auth });\r\n    return auth;\r\n  };\r\n\r\n  session = async () => {\r\n    let authClient = this.state.authClient;\r\n    let session = await authClient.session.exists(); //.then(function(exists) {\r\n\r\n    // Check for user session\r\n    if (session) {\r\n      this.setState({ session: true });\r\n      let user = await authClient.session.get();\r\n      // $(\"#user\").html(user.login);\r\n\r\n      // Request token for API access\r\n      let options = {\r\n        method: \"POST\",\r\n        mode: \"same-origin\",\r\n        credentials: \"same-origin\",\r\n        headers: {\r\n          \"Content-Type\": \"application/json\"\r\n        },\r\n        body: JSON.stringify({ entity: { login: user.login, request: \"test\" } })\r\n      };\r\n\r\n      fetch(\"/foodcommune/secure\", options)\r\n        .then(res => {\r\n          if (res) return res.json();\r\n        })\r\n        .then(res => {\r\n          if (res.success) {\r\n            if (this.props.setToken) this.props.setToken(res.token);\r\n            if (this.props.setUser) this.props.setUser(res.user);\r\n            this.setState({ username: res.user.first_name });\r\n          }\r\n        })\r\n        .then(() => {\r\n          if (this.props.viewData) this.props.viewData();\r\n        })\r\n        .catch(err => {\r\n          console.log(err);\r\n        });\r\n    } else {\r\n      //     this.setState({ session: false });\r\n      //     console.log(window.location.href)\r\n      //   If signed out and not on home page redirect\r\n      //   if (window.location.href !== \"/foodcommune/\") {\r\n      // setTimeout(function() {\r\n      //   window.location.replace(\"/foodcommune\");\r\n      // }, 1);\r\n      //   }\r\n\r\n      // Get provisional site access\r\n      let options = {\r\n        method: \"POST\",\r\n        mode: \"same-origin\",\r\n        credentials: \"same-origin\",\r\n        headers: {\r\n          \"Content-Type\": \"application/json\"\r\n        },\r\n        body: JSON.stringify({ access: this.state.provisional })\r\n      };\r\n      fetch(\"/foodcommune/secure/provisional\", options)\r\n        .then(res => {\r\n          return res.json();\r\n        })\r\n        .then(res => {\r\n          this.setState({ provisional: res.token });\r\n          this.props.updateParentState({ provisional: res.token });\r\n        })\r\n        .catch(err => {\r\n        console.log(err)\r\n      })\r\n    }\r\n  };\r\n\r\n  render() {\r\n    return (\r\n      <React.Fragment>\r\n        {/* User sign in/create account */}\r\n        {!this.state.session && (\r\n          <React.Fragment>\r\n            <span\r\n              id=\"open-account\"\r\n              className=\"nav-item nav-link\"\r\n              onClick={this.props.createAccount}\r\n            >\r\n              Create Account\r\n            </span>\r\n            <span\r\n              id=\"open-signin\"\r\n              className=\"nav-item nav-link\"\r\n              onClick={this.props.signIn}\r\n            >\r\n              Sign In\r\n            </span>\r\n          </React.Fragment>\r\n        )}\r\n\r\n        {/* User signed in */}\r\n        {this.state.session && (\r\n          <div>\r\n            <div\r\n              onClick={this.userMenu}\r\n              style={{\r\n                display: \"flex\",\r\n                alignItems: \"center\",\r\n                position: \"relative\"\r\n              }}\r\n            >\r\n              <i className=\"fas fa-user-circle fa-2x mr-1 fc-green\"></i>\r\n              <span id=\"user\" style={{ color: \"dimgray\" }}>\r\n                {this.state.username}\r\n              </span>\r\n              <i className=\"fas fa-caret-down ml-3\"></i>\r\n              {this.state.userMenu && (\r\n                <div id=\"user-menu\">\r\n                  <ul style={{ listStyle: \"none\", padding: \"10px\" }}>\r\n                    <li\r\n                      style={{ cursor: \"pointer\" }}\r\n                      onClick={() => this.state.authClient.signOut()}\r\n                    >\r\n                      Sign Out\r\n                    </li>\r\n                    <li\r\n                      style={{ cursor: \"pointer\" }}\r\n                      onClick={() =>\r\n                        (window.location.href = \"/foodcommune/mydashboard.html\")\r\n                      }\r\n                    >\r\n                      Dashboard\r\n                    </li>\r\n                    <li style={{ cursor: \"pointer\" }}>Settings</li>\r\n                  </ul>\r\n                </div>\r\n              )}\r\n            </div>\r\n          </div>\r\n        )}\r\n      </React.Fragment>\r\n    );\r\n  }\r\n}\r\n\r\nexport default UserStatus;\r\n"]},"metadata":{},"sourceType":"module"}