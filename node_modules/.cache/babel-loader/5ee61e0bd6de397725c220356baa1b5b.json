{"ast":null,"code":"import _objectSpread from\"C:\\\\Users\\\\xmark\\\\Desktop\\\\Code\\\\Servers\\\\Qumoc\\\\food-commune\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/objectSpread2\";import _toConsumableArray from\"C:\\\\Users\\\\xmark\\\\Desktop\\\\Code\\\\Servers\\\\Qumoc\\\\food-commune\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/toConsumableArray\";import _classCallCheck from\"C:\\\\Users\\\\xmark\\\\Desktop\\\\Code\\\\Servers\\\\Qumoc\\\\food-commune\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/classCallCheck\";import _createClass from\"C:\\\\Users\\\\xmark\\\\Desktop\\\\Code\\\\Servers\\\\Qumoc\\\\food-commune\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/createClass\";import _inherits from\"C:\\\\Users\\\\xmark\\\\Desktop\\\\Code\\\\Servers\\\\Qumoc\\\\food-commune\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/inherits\";import _createSuper from\"C:\\\\Users\\\\xmark\\\\Desktop\\\\Code\\\\Servers\\\\Qumoc\\\\food-commune\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/createSuper\";import React,{Component}from\"react\";import AddDeal from\"./AddDeal\";import Profile from\"./Profile\";import Buys from\"./Buys\";import Deals from\"./Deals\";import MyGroups from\"./MyGroups\";var DashboardView=/*#__PURE__*/function(_Component){_inherits(DashboardView,_Component);var _super=_createSuper(DashboardView);function DashboardView(){var _this;_classCallCheck(this,DashboardView);for(var _len=arguments.length,args=new Array(_len),_key=0;_key<_len;_key++){args[_key]=arguments[_key];}_this=_super.call.apply(_super,[this].concat(args));_this.state={token:null,user:null,data:null,showAddDeal:false,editDeal:null};_this.viewData=function(){fetchData(_this.state.token,_this.state.user.id).then(function(resolved){console.log(resolved);_this.setState({data:resolved});}).catch(function(err){console.log(err);});};_this.newDeal=function(payload){insertDeal(_this.state.token,_this.state.user.id,payload).then(function(resolved){console.log(resolved);}).catch(function(err){console.log(err);});};_this.updateDeal=function(payload){updateDealEdit(_this.state.token,_this.state.user.id,payload).then(function(resolved){console.log(resolved);_this.setState(function(prevState){var Deals=_toConsumableArray(prevState.data.Deals);var deal=Deals.findIndex(function(obj){return obj.id===payload.id;});Deals[deal]=payload;var data=_objectSpread({},prevState.data,{Deals:Deals});return{data:data};},function(){_this.setState({showAddDeal:false});});}).catch(function(err){console.log(err);});};_this.setToken=function(token){_this.setState({token:token});};_this.setUser=function(user){_this.setState({user:user});};_this.showAddDeal=function(toggle){_this.setState({showAddDeal:_this.state.showAddDeal?false:true,editDeal:null});};_this.editDeal=function(index){_this.setState({editDeal:_this.state.data.Deals[index],showAddDeal:true});};_this.updateProfile=function(payload){updateUserProfile(_this.state.token,_this.state.user.id,payload).then(function(resolved){console.log(resolved);_this.setState(function(prevState){var user=_objectSpread({},prevState.user);var keys=Object.keys(payload);keys.forEach(function(k){user[k]=payload[k];});return{user:user};});}).catch(function(err){console.log(err);});};return _this;}_createClass(DashboardView,[{key:\"render\",value:function render(){return/*#__PURE__*/React.createElement(React.Fragment,null,/*#__PURE__*/React.createElement(\"div\",{id:\"dashboard\",className:\"row row-border justify-content-center\"},this.state.showAddDeal&&/*#__PURE__*/React.createElement(AddDeal,{editDeal:this.state.editDeal,showAddDeal:this.showAddDeal,user:this.state.user,newDeal:this.newDeal,updateDeal:this.updateDeal}),/*#__PURE__*/React.createElement(\"div\",{id:\"main-content\",className:\"col-sm-12 col-md-10 spartan py-4\"},/*#__PURE__*/React.createElement(\"div\",{className:\"row\"},/*#__PURE__*/React.createElement(\"div\",{id:\"profile-card\",className:\"col-sm-12 col-lg-6 d-flex\"},/*#__PURE__*/React.createElement(Profile,{updateProfile:this.updateProfile})),/*#__PURE__*/React.createElement(\"div\",{id:\"groups-card\",className:\"col-sm-12 col-lg-6 d-flex\"},/*#__PURE__*/React.createElement(MyGroups,{data:this.state.data}))),/*#__PURE__*/React.createElement(\"div\",{className:\"row mt-4\"},/*#__PURE__*/React.createElement(\"div\",{id:\"buys-card\",className:\"col-12\"},/*#__PURE__*/React.createElement(Buys,{data:this.state.data}))),/*#__PURE__*/React.createElement(\"div\",{className:\"row mt-4\"},/*#__PURE__*/React.createElement(\"div\",{id:\"buys-card\",className:\"col-12\"},/*#__PURE__*/React.createElement(Deals,{showAddDeal:this.showAddDeal,data:this.state.data,user:this.state.user,editDeal:this.editDeal}))))));}}]);return DashboardView;}(Component);export default DashboardView;function fetchData(token,userid){console.log(\"fetching data......\",token,userid);return new Promise(function(resolve,reject){var request={userId:userid};var options={method:\"POST\",headers:new Headers({Authorization:\"Bearer \"+token,\"Content-Type\":\"application/json\"}),body:JSON.stringify({entity:request})};fetch(\"https://qumoc.com/foodcommune/accounts/dashboard\",options).then(function(res){if(res)return res.json();}).then(function(res){if(!res.success){// Return to account detail and display error message\nresolve(res);}else{reject(\"Unable to retrieve data\");}});});}function insertDeal(token,userid,payload){console.log(\"fetching data......\",token,userid);payload.user_id=userid;// Append user_id to payload\nreturn new Promise(function(resolve,reject){var options={method:\"POST\",headers:new Headers({Authorization:\"Bearer \"+token,\"Content-Type\":\"application/json\"}),body:JSON.stringify({entity:payload})};fetch(\"/foodcommune/accounts/insertDeal\",options).then(function(res){return res.json();}).then(function(res){if(!res.success){// Return to account detail and display error message\nresolve(res);}else{reject(res);}});});}function updateDealEdit(token,userid,payload){console.log(\"fetching data......\",token,userid);payload.user_id=userid;// Append user_id to payload\nreturn new Promise(function(resolve,reject){var options={method:\"POST\",headers:new Headers({Authorization:\"Bearer \"+token,\"Content-Type\":\"application/json\"}),body:JSON.stringify({entity:payload})};fetch(\"/foodcommune/accounts/updateDeal\",options).then(function(res){return res.json();}).then(function(res){if(res.success){// Return to account detail and display error message\nresolve(res);}else{reject(res);}});});}function updateUserProfile(token,userid,payload){var payloadObj={userId:userid,values:payload};console.log(\"fetching data......\",token,userid);return new Promise(function(resolve,reject){var options={method:\"POST\",headers:new Headers({Authorization:\"Bearer \"+token,\"Content-Type\":\"application/json\"}),body:JSON.stringify({entity:payloadObj})};fetch(\"/foodcommune/accounts/updateUserProfile\",options).then(function(res){return res.json();}).then(function(res){if(res.success){// Return to account detail and display error message\nresolve(res);}else{reject(res);}});});}","map":{"version":3,"sources":["C:/Users/xmark/Desktop/Code/Servers/Qumoc/food-commune/src/components/DashboardView.jsx"],"names":["React","Component","AddDeal","Profile","Buys","Deals","MyGroups","DashboardView","state","token","user","data","showAddDeal","editDeal","viewData","fetchData","id","then","resolved","console","log","setState","catch","err","newDeal","payload","insertDeal","updateDeal","updateDealEdit","prevState","deal","findIndex","obj","setToken","setUser","toggle","index","updateProfile","updateUserProfile","keys","Object","forEach","k","userid","Promise","resolve","reject","request","userId","options","method","headers","Headers","Authorization","body","JSON","stringify","entity","fetch","res","json","success","user_id","payloadObj","values"],"mappings":"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","sourcesContent":["import React, { Component } from \"react\";\r\nimport AddDeal from \"./AddDeal\";\r\nimport Profile from \"./Profile\";\r\nimport Buys from \"./Buys\";\r\nimport Deals from \"./Deals\";\r\nimport MyGroups from \"./MyGroups\";\r\n\r\nclass DashboardView extends Component {\r\n  state = {\r\n    token: null,\r\n    user: null,\r\n    data: null,\r\n    showAddDeal: false,\r\n    editDeal: null\r\n  };\r\n\r\n  viewData = () => {\r\n    fetchData(this.state.token, this.state.user.id)\r\n      .then(resolved => {\r\n        console.log(resolved);\r\n        this.setState({ data: resolved });\r\n      })\r\n      .catch(err => {\r\n        console.log(err);\r\n      });\r\n  };\r\n\r\n  newDeal = payload => {\r\n    insertDeal(this.state.token, this.state.user.id, payload)\r\n      .then(resolved => {\r\n        console.log(resolved);\r\n      })\r\n      .catch(err => {\r\n        console.log(err);\r\n      });\r\n  };\r\n\r\n  updateDeal = payload => {\r\n    updateDealEdit(this.state.token, this.state.user.id, payload)\r\n      .then(resolved => {\r\n        console.log(resolved);\r\n        this.setState(\r\n          prevState => {\r\n            let Deals = [...prevState.data.Deals];\r\n            let deal = Deals.findIndex(obj => {\r\n              return obj.id === payload.id;\r\n            });\r\n            Deals[deal] = payload;\r\n\r\n            let data = { ...prevState.data, Deals: Deals };\r\n            return { data: data };\r\n          },\r\n          () => {\r\n            this.setState({ showAddDeal: false });\r\n          }\r\n        );\r\n      })\r\n      .catch(err => {\r\n        console.log(err);\r\n      });\r\n  };\r\n\r\n  setToken = token => {\r\n    this.setState({ token: token });\r\n  };\r\n\r\n  setUser = user => {\r\n    this.setState({ user: user });\r\n  };\r\n\r\n  showAddDeal = toggle => {\r\n    this.setState({\r\n      showAddDeal: this.state.showAddDeal ? false : true,\r\n      editDeal: null\r\n    });\r\n  };\r\n\r\n  editDeal = index => {\r\n    this.setState({\r\n      editDeal: this.state.data.Deals[index],\r\n      showAddDeal: true\r\n    });\r\n  };\r\n\r\n  updateProfile = payload => {\r\n    updateUserProfile(this.state.token, this.state.user.id, payload)\r\n      .then(resolved => {\r\n        console.log(resolved);\r\n        this.setState(prevState => {\r\n          let user = { ...prevState.user };\r\n          let keys = Object.keys(payload);\r\n          keys.forEach(k => {\r\n            user[k] = payload[k];\r\n          });\r\n\r\n          return { user: user };\r\n        });\r\n      })\r\n      .catch(err => {\r\n        console.log(err);\r\n      });\r\n  };\r\n\r\n  render() {\r\n    return (\r\n      <React.Fragment>\r\n        {/* Dashboard */}\r\n        <div id=\"dashboard\" className=\"row row-border justify-content-center\">\r\n          {/* Add Deal */}\r\n          {this.state.showAddDeal && (\r\n            <AddDeal\r\n              editDeal={this.state.editDeal}\r\n              showAddDeal={this.showAddDeal}\r\n              user={this.state.user}\r\n              newDeal={this.newDeal}\r\n              updateDeal={this.updateDeal}\r\n            />\r\n          )}\r\n          <div id=\"main-content\" className=\"col-sm-12 col-md-10 spartan py-4\">\r\n            <div className=\"row\">\r\n              <div id=\"profile-card\" className=\"col-sm-12 col-lg-6 d-flex\">\r\n                {/* <!-- PROFILE --> */}\r\n\r\n                <Profile\r\n                  updateProfile={this.updateProfile}\r\n                />\r\n              </div>\r\n\r\n              <div id=\"groups-card\" className=\"col-sm-12 col-lg-6 d-flex\">\r\n                {/* <!-- GROUPS --> */}\r\n                <MyGroups data={this.state.data} />\r\n              </div>\r\n            </div>\r\n            <div className=\"row mt-4\">\r\n              <div id=\"buys-card\" className=\"col-12\">\r\n                {/* <!-- BUYS --> */}\r\n                <Buys data={this.state.data} />\r\n              </div>\r\n            </div>\r\n            <div className=\"row mt-4\">\r\n              <div id=\"buys-card\" className=\"col-12\">\r\n                {/* <!-- DEALS --> */}\r\n                <Deals\r\n                  showAddDeal={this.showAddDeal}\r\n                  data={this.state.data}\r\n                  user={this.state.user}\r\n                  editDeal={this.editDeal}\r\n                />\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </React.Fragment>\r\n    );\r\n  }\r\n}\r\n\r\nexport default DashboardView;\r\n\r\nfunction fetchData(token, userid) {\r\n  console.log(\"fetching data......\", token, userid);\r\n  return new Promise((resolve, reject) => {\r\n    let request = { userId: userid };\r\n    let options = {\r\n      method: \"POST\",\r\n      headers: new Headers({\r\n        Authorization: \"Bearer \" + token,\r\n        \"Content-Type\": \"application/json\"\r\n      }),\r\n      body: JSON.stringify({\r\n        entity: request\r\n      })\r\n    };\r\n    fetch(\"https://qumoc.com/foodcommune/accounts/dashboard\", options)\r\n      .then(res => {\r\n        if (res) return res.json();\r\n      })\r\n      .then(res => {\r\n        if (!res.success) {\r\n          // Return to account detail and display error message\r\n          resolve(res);\r\n        } else {\r\n          reject(\"Unable to retrieve data\");\r\n        }\r\n      });\r\n  });\r\n}\r\n\r\nfunction insertDeal(token, userid, payload) {\r\n  console.log(\"fetching data......\", token, userid);\r\n  payload.user_id = userid; // Append user_id to payload\r\n  return new Promise((resolve, reject) => {\r\n    let options = {\r\n      method: \"POST\",\r\n      headers: new Headers({\r\n        Authorization: \"Bearer \" + token,\r\n        \"Content-Type\": \"application/json\"\r\n      }),\r\n      body: JSON.stringify({\r\n        entity: payload\r\n      })\r\n    };\r\n    fetch(\"/foodcommune/accounts/insertDeal\", options)\r\n      .then(res => {\r\n        return res.json();\r\n      })\r\n      .then(res => {\r\n        if (!res.success) {\r\n          // Return to account detail and display error message\r\n          resolve(res);\r\n        } else {\r\n          reject(res);\r\n        }\r\n      });\r\n  });\r\n}\r\n\r\nfunction updateDealEdit(token, userid, payload) {\r\n  console.log(\"fetching data......\", token, userid);\r\n  payload.user_id = userid; // Append user_id to payload\r\n  return new Promise((resolve, reject) => {\r\n    let options = {\r\n      method: \"POST\",\r\n      headers: new Headers({\r\n        Authorization: \"Bearer \" + token,\r\n        \"Content-Type\": \"application/json\"\r\n      }),\r\n      body: JSON.stringify({\r\n        entity: payload\r\n      })\r\n    };\r\n    fetch(\"/foodcommune/accounts/updateDeal\", options)\r\n      .then(res => {\r\n        return res.json();\r\n      })\r\n      .then(res => {\r\n        if (res.success) {\r\n          // Return to account detail and display error message\r\n          resolve(res);\r\n        } else {\r\n          reject(res);\r\n        }\r\n      });\r\n  });\r\n}\r\n\r\nfunction updateUserProfile(token, userid, payload) {\r\n  let payloadObj = { userId: userid, values: payload };\r\n  console.log(\"fetching data......\", token, userid);\r\n  return new Promise((resolve, reject) => {\r\n    let options = {\r\n      method: \"POST\",\r\n      headers: new Headers({\r\n        Authorization: \"Bearer \" + token,\r\n        \"Content-Type\": \"application/json\"\r\n      }),\r\n      body: JSON.stringify({\r\n        entity: payloadObj\r\n      })\r\n    };\r\n    fetch(\"/foodcommune/accounts/updateUserProfile\", options)\r\n      .then(res => {\r\n        return res.json();\r\n      })\r\n      .then(res => {\r\n        if (res.success) {\r\n          // Return to account detail and display error message\r\n          resolve(res);\r\n        } else {\r\n          reject(res);\r\n        }\r\n      });\r\n  });\r\n}\r\n"]},"metadata":{},"sourceType":"module"}