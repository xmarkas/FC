{"ast":null,"code":"import _regeneratorRuntime from\"C:\\\\Users\\\\xmark\\\\Desktop\\\\Code\\\\Servers\\\\FC-SERVER\\\\food-commune\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/regenerator\";import _asyncToGenerator from\"C:\\\\Users\\\\xmark\\\\Desktop\\\\Code\\\\Servers\\\\FC-SERVER\\\\food-commune\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/asyncToGenerator\";/**\r\n * File:        okta.js\r\n * \r\n * Description: \r\n */import store from'../store/js/index';import{setSession,expiringSession,expireRedirect,cancelSession}from'../store/actions/index';// import OktaAuth from '@okta/okta-auth-js';\n// let OktaAuth = require('@okta/okta-auth-js');\nconsole.log(\"running auth client..\");// Okta browser SDK AuthClient\n// var config = {\n//     issuer: \"https://dev-236245.okta.com/oauth2/default\",\n//     clientId: \"0oa4lqivbsKPbAtfs4x6\",\n//     redirectUri: \"https://qumoc.com/foodcommune\",\n//     responseMode: \"fragment\",\n//     tokenManager: {\n//         storage: \"sessionStorage\"\n//     },\n//     // onSessionExpired: function () {\n//     //     console.log(\"re-authorization is required\");\n//     //     // authClient.getWithRedirect();\n//     // }\n// };\n// // AUTH CLIENT\n// let authClient = new OktaAuth(config);\nexport var session=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var options;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:options={method:\"POST\",mode:\"same-origin\",credentials:\"same-origin\",headers:{\"Content-Type\":\"application/json\"}};fetch(\"/site/usersession\",options).then(function(res){if(res)return res.json();}).then(function(res){if(res.success){tokenExpHandler(res.tokenExpiresAt);store.dispatch(setSession({token:res.token,user:res.user,tokenExpiresAt:res.tokenExpiresAt}));}}).catch(function(err){console.log(err);});case 2:case\"end\":return _context.stop();}}},_callee);}));return function session(){return _ref.apply(this,arguments);};}();export var getToken=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(session){var options,_options;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:console.log(\"GETTOKEN\");// Check for user session\nif(session){// Request token for API access\noptions={method:\"POST\",mode:\"same-origin\",credentials:\"same-origin\",headers:{\"Content-Type\":\"application/json\"},body:JSON.stringify({entity:{login:session.user.profile.login,request:\"test\"}})};fetch(\"/secure\",options).then(function(res){if(res)return res.json();}).then(function(res){console.log(res);if(res.success){tokenExpHandler(res.tokenExpiresAt);store.dispatch(setSession({token:res.token,user:res.user}));}}).catch(function(err){console.log(err);});}else{// Get provisional site access\n_options={method:\"POST\",mode:\"same-origin\",credentials:\"same-origin\",headers:{\"Content-Type\":\"application/json\"},body:JSON.stringify({})};fetch(\"/secure/provisional\",_options).then(function(res){return res.json();}).then(function(res){store.dispatch(setSession({provisional:res.token}));}).catch(function(err){console.log(err);store.dispatch(setSession({provisional:\"test token\"}));});}case 2:case\"end\":return _context2.stop();}}},_callee2);}));return function getToken(_x){return _ref2.apply(this,arguments);};}();export var signInAuthenticate=/*#__PURE__*/function(){var _ref3=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee3(email,password){return _regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:_context3.next=2;return authClient.signIn({username:email,password:password}).catch(function(err){// this.setState({ errMsg: \"Email or password is incorrect!\" });\nconsole.log(err);return false;}).then(function(res){console.log(res);if(res.status==='SUCCESS'){getToken(res);return true;}else{return false;}});case 2:return _context3.abrupt(\"return\",_context3.sent);case 3:case\"end\":return _context3.stop();}}},_callee3);}));return function signInAuthenticate(_x2,_x3){return _ref3.apply(this,arguments);};}();export var signOut=function signOut(){// authClient.signOut();\nstore.dispatch(cancelSession());};function tokenExpHandler(tokenExpiresAt){var currentTime=new Date().getTime()/1000;var expireMin=tokenExpiresAt-currentTime;// Time token expires\n// Set warning timeout - convert to millisecods\nvar expWarning=setTimeout(function(){store.dispatch(expiringSession(true));},(expireMin-60)*1000);// Set timeout for redirect if user doesn't choose to stay signed in\nvar logOut=setTimeout(function(){window.location.href=\"https://foodcommune.com\";},expireMin*1000);// Send handler for redirect to store - cancels if user continues session\nstore.dispatch(expireRedirect(logOut));}","map":{"version":3,"sources":["C:/Users/xmark/Desktop/Code/Servers/FC-SERVER/food-commune/src/util/okta.js"],"names":["store","setSession","expiringSession","expireRedirect","cancelSession","console","log","session","options","method","mode","credentials","headers","fetch","then","res","json","success","tokenExpHandler","tokenExpiresAt","dispatch","token","user","catch","err","getToken","body","JSON","stringify","entity","login","profile","request","provisional","signInAuthenticate","email","password","authClient","signIn","username","status","signOut","currentTime","Date","getTime","expireMin","expWarning","setTimeout","logOut","window","location","href"],"mappings":"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","sourcesContent":["/**\r\n * File:        okta.js\r\n * \r\n * Description: \r\n */\r\nimport store from '../store/js/index';\r\nimport { setSession, expiringSession, expireRedirect, cancelSession } from '../store/actions/index';\r\n// import OktaAuth from '@okta/okta-auth-js';\r\n// let OktaAuth = require('@okta/okta-auth-js');\r\n\r\n\r\n\r\nconsole.log(\"running auth client..\");\r\n// Okta browser SDK AuthClient\r\n// var config = {\r\n//     issuer: \"https://dev-236245.okta.com/oauth2/default\",\r\n//     clientId: \"0oa4lqivbsKPbAtfs4x6\",\r\n//     redirectUri: \"https://qumoc.com/foodcommune\",\r\n//     responseMode: \"fragment\",\r\n//     tokenManager: {\r\n//         storage: \"sessionStorage\"\r\n//     },\r\n//     // onSessionExpired: function () {\r\n//     //     console.log(\"re-authorization is required\");\r\n//     //     // authClient.getWithRedirect();\r\n//     // }\r\n// };\r\n\r\n// // AUTH CLIENT\r\n// let authClient = new OktaAuth(config);\r\n\r\n\r\nexport const session = async () => {\r\n    let options = {\r\n        method: \"POST\",\r\n        mode: \"same-origin\",\r\n        credentials: \"same-origin\",\r\n        headers: {\r\n            \"Content-Type\": \"application/json\"\r\n        }\r\n    };\r\n\r\n    fetch(\"/site/usersession\", options)\r\n        .then(res => {\r\n            if (res) return res.json();\r\n        })\r\n        .then(res => {\r\n            if (res.success) {\r\n                tokenExpHandler(res.tokenExpiresAt);\r\n                store.dispatch(setSession({ token: res.token, user: res.user, tokenExpiresAt: res.tokenExpiresAt }));\r\n            }\r\n        })\r\n        .catch(err => {\r\n            console.log(err);\r\n        })\r\n}\r\n\r\nexport const getToken = async (session) => {\r\n    console.log(\"GETTOKEN\")\r\n    // Check for user session\r\n    if (session) {\r\n\r\n        // Request token for API access\r\n        let options = {\r\n            method: \"POST\",\r\n            mode: \"same-origin\",\r\n            credentials: \"same-origin\",\r\n            headers: {\r\n                \"Content-Type\": \"application/json\"\r\n            },\r\n            body: JSON.stringify({ entity: { login: session.user.profile.login, request: \"test\" } })\r\n        };\r\n\r\n        fetch(\"/secure\", options)\r\n            .then(res => {\r\n                if (res) return res.json();\r\n            })\r\n            .then(res => {\r\n                console.log(res);\r\n                if (res.success) {\r\n                    tokenExpHandler(res.tokenExpiresAt);\r\n                    store.dispatch(setSession({ token: res.token, user: res.user }));\r\n                }\r\n            })\r\n            .catch(err => {\r\n                console.log(err);\r\n            });\r\n    } else {\r\n\r\n        // Get provisional site access\r\n        let options = {\r\n            method: \"POST\",\r\n            mode: \"same-origin\",\r\n            credentials: \"same-origin\",\r\n            headers: {\r\n                \"Content-Type\": \"application/json\"\r\n            },\r\n            body: JSON.stringify({})\r\n        };\r\n        fetch(\"/secure/provisional\", options)\r\n            .then(res => {\r\n                return res.json();\r\n            })\r\n            .then(res => {\r\n                store.dispatch(setSession({ provisional: res.token }));\r\n            })\r\n            .catch(err => {\r\n                console.log(err)\r\n                store.dispatch(setSession({ provisional: \"test token\" }));\r\n            })\r\n    }\r\n};\r\n\r\nexport const signInAuthenticate = async (email, password) => {\r\n    return await authClient\r\n        .signIn({\r\n            username: email,\r\n            password: password\r\n        })\r\n        .catch(err => {\r\n            // this.setState({ errMsg: \"Email or password is incorrect!\" });\r\n            console.log(err);\r\n            return false;\r\n        })\r\n        .then(res => {\r\n            console.log(res);\r\n            if (res.status === 'SUCCESS') {\r\n                getToken(res);\r\n                return true;\r\n            } else {\r\n                return false;\r\n            }\r\n        })\r\n}\r\n\r\nexport const signOut = () => {\r\n    // authClient.signOut();\r\n    store.dispatch(cancelSession());\r\n}\r\n\r\nfunction tokenExpHandler(tokenExpiresAt) {\r\n    let currentTime = new Date().getTime() / 1000;\r\n    let expireMin = (tokenExpiresAt - currentTime); // Time token expires\r\n\r\n    // Set warning timeout - convert to millisecods\r\n    let expWarning = setTimeout(() => {\r\n        store.dispatch(expiringSession(true));\r\n    }, (expireMin - 60) * 1000);\r\n\r\n    // Set timeout for redirect if user doesn't choose to stay signed in\r\n    let logOut = setTimeout(() => {\r\n        window.location.href = \"https://foodcommune.com\";\r\n    }, expireMin * 1000);\r\n\r\n    // Send handler for redirect to store - cancels if user continues session\r\n    store.dispatch(expireRedirect(logOut));\r\n}"]},"metadata":{},"sourceType":"module"}