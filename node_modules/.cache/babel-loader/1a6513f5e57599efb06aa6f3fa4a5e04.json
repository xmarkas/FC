{"ast":null,"code":"import _objectSpread from\"C:\\\\Users\\\\xmark\\\\Desktop\\\\Code\\\\Servers\\\\Qumoc\\\\food-commune\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/objectSpread2\";import _toConsumableArray from\"C:\\\\Users\\\\xmark\\\\Desktop\\\\Code\\\\Servers\\\\Qumoc\\\\food-commune\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/toConsumableArray\";import _classCallCheck from\"C:\\\\Users\\\\xmark\\\\Desktop\\\\Code\\\\Servers\\\\Qumoc\\\\food-commune\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/classCallCheck\";import _createClass from\"C:\\\\Users\\\\xmark\\\\Desktop\\\\Code\\\\Servers\\\\Qumoc\\\\food-commune\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/createClass\";import _inherits from\"C:\\\\Users\\\\xmark\\\\Desktop\\\\Code\\\\Servers\\\\Qumoc\\\\food-commune\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/inherits\";import _createSuper from\"C:\\\\Users\\\\xmark\\\\Desktop\\\\Code\\\\Servers\\\\Qumoc\\\\food-commune\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/createSuper\";import React,{Component}from\"react\";import{connect}from\"react-redux\";import AddDeal from\"./AddDeal\";import Profile from\"./Profile\";import Buys from\"./Buys\";import Deals from\"./Deals\";import MyGroups from\"./MyGroups\";var mapStateToProps=function mapStateToProps(state){return{user:state.user,token:state.token};};var DashboardView=/*#__PURE__*/function(_Component){_inherits(DashboardView,_Component);var _super=_createSuper(DashboardView);function DashboardView(){var _this;_classCallCheck(this,DashboardView);for(var _len=arguments.length,args=new Array(_len),_key=0;_key<_len;_key++){args[_key]=arguments[_key];}_this=_super.call.apply(_super,[this].concat(args));_this.state={token:null,user:null,data:null,showAddDeal:false,editDeal:null};_this.newDeal=function(payload){insertDeal(_this.state.token,_this.state.user.id,payload).then(function(resolved){console.log(resolved);}).catch(function(err){console.log(err);});};_this.updateDeal=function(payload){updateDealEdit(_this.state.token,_this.state.user.id,payload).then(function(resolved){console.log(resolved);_this.setState(function(prevState){var Deals=_toConsumableArray(prevState.data.Deals);var deal=Deals.findIndex(function(obj){return obj.id===payload.id;});Deals[deal]=payload;var data=_objectSpread({},prevState.data,{Deals:Deals});return{data:data};},function(){_this.setState({showAddDeal:false});});}).catch(function(err){console.log(err);});};_this.showAddDeal=function(toggle){_this.setState({showAddDeal:_this.state.showAddDeal?false:true,editDeal:null});};_this.editDeal=function(index){_this.setState({editDeal:_this.state.data.Deals[index],showAddDeal:true});};_this.updateProfile=function(payload){updateUserProfile(_this.state.token,_this.state.user.id,payload).then(function(resolved){console.log(resolved);_this.setState(function(prevState){var user=_objectSpread({},prevState.user);var keys=Object.keys(payload);keys.forEach(function(k){user[k]=payload[k];});return{user:user};});}).catch(function(err){console.log(err);});};return _this;}_createClass(DashboardView,[{key:\"componentWillMount\",value:function componentWillMount(){var _this2=this;fetchData(this.state.token,this.state.user.id).then(function(resolved){console.log(resolved);_this2.setState({data:resolved});}).catch(function(err){console.log(err);});}},{key:\"render\",value:function render(){return/*#__PURE__*/React.createElement(React.Fragment,null,/*#__PURE__*/React.createElement(\"div\",{id:\"dashboard\",className:\"row row-border justify-content-center\"},this.state.showAddDeal&&/*#__PURE__*/React.createElement(AddDeal,{editDeal:this.state.editDeal,showAddDeal:this.showAddDeal,user:this.state.user,newDeal:this.newDeal,updateDeal:this.updateDeal}),/*#__PURE__*/React.createElement(\"div\",{id:\"main-content\",className:\"col-sm-12 col-md-10 spartan py-4\"},/*#__PURE__*/React.createElement(\"div\",{className:\"row\"},/*#__PURE__*/React.createElement(\"div\",{id:\"profile-card\",className:\"col-sm-12 col-lg-6 d-flex\"},/*#__PURE__*/React.createElement(Profile,{updateProfile:this.updateProfile})),/*#__PURE__*/React.createElement(\"div\",{id:\"groups-card\",className:\"col-sm-12 col-lg-6 d-flex\"},/*#__PURE__*/React.createElement(MyGroups,{data:this.state.data}))),/*#__PURE__*/React.createElement(\"div\",{className:\"row mt-4\"},/*#__PURE__*/React.createElement(\"div\",{id:\"buys-card\",className:\"col-12\"},/*#__PURE__*/React.createElement(Buys,{data:this.state.data}))),/*#__PURE__*/React.createElement(\"div\",{className:\"row mt-4\"},/*#__PURE__*/React.createElement(\"div\",{id:\"buys-card\",className:\"col-12\"},/*#__PURE__*/React.createElement(Deals,{showAddDeal:this.showAddDeal,data:this.state.data,user:this.state.user,editDeal:this.editDeal}))))));}}]);return DashboardView;}(Component);export default connect(mapStateToProps)(DashboardView);function fetchData(token,userid){console.log(\"fetching data......\",token,userid);return new Promise(function(resolve,reject){var request={userId:userid};var options={method:\"POST\",headers:new Headers({Authorization:\"Bearer \"+token,\"Content-Type\":\"application/json\"}),body:JSON.stringify({entity:request})};fetch(\"https://qumoc.com/foodcommune/accounts/dashboard\",options).then(function(res){if(res)return res.json();}).then(function(res){if(!res.success){// Return to account detail and display error message\nresolve(res);}else{reject(\"Unable to retrieve data\");}});});}function insertDeal(token,userid,payload){console.log(\"fetching data......\",token,userid);payload.user_id=userid;// Append user_id to payload\nreturn new Promise(function(resolve,reject){var options={method:\"POST\",headers:new Headers({Authorization:\"Bearer \"+token,\"Content-Type\":\"application/json\"}),body:JSON.stringify({entity:payload})};fetch(\"/foodcommune/accounts/insertDeal\",options).then(function(res){return res.json();}).then(function(res){if(!res.success){// Return to account detail and display error message\nresolve(res);}else{reject(res);}});});}function updateDealEdit(token,userid,payload){console.log(\"fetching data......\",token,userid);payload.user_id=userid;// Append user_id to payload\nreturn new Promise(function(resolve,reject){var options={method:\"POST\",headers:new Headers({Authorization:\"Bearer \"+token,\"Content-Type\":\"application/json\"}),body:JSON.stringify({entity:payload})};fetch(\"/foodcommune/accounts/updateDeal\",options).then(function(res){return res.json();}).then(function(res){if(res.success){// Return to account detail and display error message\nresolve(res);}else{reject(res);}});});}function updateUserProfile(token,userid,payload){var payloadObj={userId:userid,values:payload};console.log(\"fetching data......\",token,userid);return new Promise(function(resolve,reject){var options={method:\"POST\",headers:new Headers({Authorization:\"Bearer \"+token,\"Content-Type\":\"application/json\"}),body:JSON.stringify({entity:payloadObj})};fetch(\"/foodcommune/accounts/updateUserProfile\",options).then(function(res){return res.json();}).then(function(res){if(res.success){// Return to account detail and display error message\nresolve(res);}else{reject(res);}});});}","map":{"version":3,"sources":["C:/Users/xmark/Desktop/Code/Servers/Qumoc/food-commune/src/components/DashboardView.jsx"],"names":["React","Component","connect","AddDeal","Profile","Buys","Deals","MyGroups","mapStateToProps","state","user","token","DashboardView","data","showAddDeal","editDeal","newDeal","payload","insertDeal","id","then","resolved","console","log","catch","err","updateDeal","updateDealEdit","setState","prevState","deal","findIndex","obj","toggle","index","updateProfile","updateUserProfile","keys","Object","forEach","k","fetchData","userid","Promise","resolve","reject","request","userId","options","method","headers","Headers","Authorization","body","JSON","stringify","entity","fetch","res","json","success","user_id","payloadObj","values"],"mappings":"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","sourcesContent":["import React, { Component } from \"react\";\r\nimport { connect } from \"react-redux\";\r\nimport AddDeal from \"./AddDeal\";\r\nimport Profile from \"./Profile\";\r\nimport Buys from \"./Buys\";\r\nimport Deals from \"./Deals\";\r\nimport MyGroups from \"./MyGroups\";\r\n\r\nconst mapStateToProps = state => {\r\n  return {\r\n    user: state.user,\r\n    token: state.token\r\n  };\r\n};\r\n\r\nclass DashboardView extends Component {\r\n  state = {\r\n    token: null,\r\n    user: null,\r\n    data: null,\r\n    showAddDeal: false,\r\n    editDeal: null\r\n  };\r\n\r\n  componentWillMount() {\r\n    fetchData(this.state.token, this.state.user.id)\r\n      .then(resolved => {\r\n        console.log(resolved);\r\n        this.setState({ data: resolved });\r\n      })\r\n      .catch(err => {\r\n        console.log(err);\r\n      });\r\n  }\r\n\r\n  newDeal = payload => {\r\n    insertDeal(this.state.token, this.state.user.id, payload)\r\n      .then(resolved => {\r\n        console.log(resolved);\r\n      })\r\n      .catch(err => {\r\n        console.log(err);\r\n      });\r\n  };\r\n\r\n  updateDeal = payload => {\r\n    updateDealEdit(this.state.token, this.state.user.id, payload)\r\n      .then(resolved => {\r\n        console.log(resolved);\r\n        this.setState(\r\n          prevState => {\r\n            let Deals = [...prevState.data.Deals];\r\n            let deal = Deals.findIndex(obj => {\r\n              return obj.id === payload.id;\r\n            });\r\n            Deals[deal] = payload;\r\n\r\n            let data = { ...prevState.data, Deals: Deals };\r\n            return { data: data };\r\n          },\r\n          () => {\r\n            this.setState({ showAddDeal: false });\r\n          }\r\n        );\r\n      })\r\n      .catch(err => {\r\n        console.log(err);\r\n      });\r\n  };\r\n\r\n  showAddDeal = toggle => {\r\n    this.setState({\r\n      showAddDeal: this.state.showAddDeal ? false : true,\r\n      editDeal: null\r\n    });\r\n  };\r\n\r\n  editDeal = index => {\r\n    this.setState({\r\n      editDeal: this.state.data.Deals[index],\r\n      showAddDeal: true\r\n    });\r\n  };\r\n\r\n  updateProfile = payload => {\r\n    updateUserProfile(this.state.token, this.state.user.id, payload)\r\n      .then(resolved => {\r\n        console.log(resolved);\r\n        this.setState(prevState => {\r\n          let user = { ...prevState.user };\r\n          let keys = Object.keys(payload);\r\n          keys.forEach(k => {\r\n            user[k] = payload[k];\r\n          });\r\n\r\n          return { user: user };\r\n        });\r\n      })\r\n      .catch(err => {\r\n        console.log(err);\r\n      });\r\n  };\r\n\r\n  render() {\r\n    return (\r\n      <React.Fragment>\r\n        {/* Dashboard */}\r\n        <div id=\"dashboard\" className=\"row row-border justify-content-center\">\r\n          {/* Add Deal */}\r\n          {this.state.showAddDeal && (\r\n            <AddDeal\r\n              editDeal={this.state.editDeal}\r\n              showAddDeal={this.showAddDeal}\r\n              user={this.state.user}\r\n              newDeal={this.newDeal}\r\n              updateDeal={this.updateDeal}\r\n            />\r\n          )}\r\n          <div id=\"main-content\" className=\"col-sm-12 col-md-10 spartan py-4\">\r\n            <div className=\"row\">\r\n              <div id=\"profile-card\" className=\"col-sm-12 col-lg-6 d-flex\">\r\n                {/* <!-- PROFILE --> */}\r\n\r\n                <Profile updateProfile={this.updateProfile} />\r\n              </div>\r\n\r\n              <div id=\"groups-card\" className=\"col-sm-12 col-lg-6 d-flex\">\r\n                {/* <!-- GROUPS --> */}\r\n                <MyGroups data={this.state.data} />\r\n              </div>\r\n            </div>\r\n            <div className=\"row mt-4\">\r\n              <div id=\"buys-card\" className=\"col-12\">\r\n                {/* <!-- BUYS --> */}\r\n                <Buys data={this.state.data} />\r\n              </div>\r\n            </div>\r\n            <div className=\"row mt-4\">\r\n              <div id=\"buys-card\" className=\"col-12\">\r\n                {/* <!-- DEALS --> */}\r\n                <Deals\r\n                  showAddDeal={this.showAddDeal}\r\n                  data={this.state.data}\r\n                  user={this.state.user}\r\n                  editDeal={this.editDeal}\r\n                />\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </React.Fragment>\r\n    );\r\n  }\r\n}\r\n\r\nexport default connect(mapStateToProps)(DashboardView);\r\n\r\nfunction fetchData(token, userid) {\r\n  console.log(\"fetching data......\", token, userid);\r\n  return new Promise((resolve, reject) => {\r\n    let request = { userId: userid };\r\n    let options = {\r\n      method: \"POST\",\r\n      headers: new Headers({\r\n        Authorization: \"Bearer \" + token,\r\n        \"Content-Type\": \"application/json\"\r\n      }),\r\n      body: JSON.stringify({\r\n        entity: request\r\n      })\r\n    };\r\n    fetch(\"https://qumoc.com/foodcommune/accounts/dashboard\", options)\r\n      .then(res => {\r\n        if (res) return res.json();\r\n      })\r\n      .then(res => {\r\n        if (!res.success) {\r\n          // Return to account detail and display error message\r\n          resolve(res);\r\n        } else {\r\n          reject(\"Unable to retrieve data\");\r\n        }\r\n      });\r\n  });\r\n}\r\n\r\nfunction insertDeal(token, userid, payload) {\r\n  console.log(\"fetching data......\", token, userid);\r\n  payload.user_id = userid; // Append user_id to payload\r\n  return new Promise((resolve, reject) => {\r\n    let options = {\r\n      method: \"POST\",\r\n      headers: new Headers({\r\n        Authorization: \"Bearer \" + token,\r\n        \"Content-Type\": \"application/json\"\r\n      }),\r\n      body: JSON.stringify({\r\n        entity: payload\r\n      })\r\n    };\r\n    fetch(\"/foodcommune/accounts/insertDeal\", options)\r\n      .then(res => {\r\n        return res.json();\r\n      })\r\n      .then(res => {\r\n        if (!res.success) {\r\n          // Return to account detail and display error message\r\n          resolve(res);\r\n        } else {\r\n          reject(res);\r\n        }\r\n      });\r\n  });\r\n}\r\n\r\nfunction updateDealEdit(token, userid, payload) {\r\n  console.log(\"fetching data......\", token, userid);\r\n  payload.user_id = userid; // Append user_id to payload\r\n  return new Promise((resolve, reject) => {\r\n    let options = {\r\n      method: \"POST\",\r\n      headers: new Headers({\r\n        Authorization: \"Bearer \" + token,\r\n        \"Content-Type\": \"application/json\"\r\n      }),\r\n      body: JSON.stringify({\r\n        entity: payload\r\n      })\r\n    };\r\n    fetch(\"/foodcommune/accounts/updateDeal\", options)\r\n      .then(res => {\r\n        return res.json();\r\n      })\r\n      .then(res => {\r\n        if (res.success) {\r\n          // Return to account detail and display error message\r\n          resolve(res);\r\n        } else {\r\n          reject(res);\r\n        }\r\n      });\r\n  });\r\n}\r\n\r\nfunction updateUserProfile(token, userid, payload) {\r\n  let payloadObj = { userId: userid, values: payload };\r\n  console.log(\"fetching data......\", token, userid);\r\n  return new Promise((resolve, reject) => {\r\n    let options = {\r\n      method: \"POST\",\r\n      headers: new Headers({\r\n        Authorization: \"Bearer \" + token,\r\n        \"Content-Type\": \"application/json\"\r\n      }),\r\n      body: JSON.stringify({\r\n        entity: payloadObj\r\n      })\r\n    };\r\n    fetch(\"/foodcommune/accounts/updateUserProfile\", options)\r\n      .then(res => {\r\n        return res.json();\r\n      })\r\n      .then(res => {\r\n        if (res.success) {\r\n          // Return to account detail and display error message\r\n          resolve(res);\r\n        } else {\r\n          reject(res);\r\n        }\r\n      });\r\n  });\r\n}\r\n"]},"metadata":{},"sourceType":"module"}