{"ast":null,"code":"import _objectSpread from\"C:\\\\Users\\\\xmark\\\\Desktop\\\\Code\\\\Servers\\\\Qumoc\\\\food-commune\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/objectSpread2\";import _toConsumableArray from\"C:\\\\Users\\\\xmark\\\\Desktop\\\\Code\\\\Servers\\\\Qumoc\\\\food-commune\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/toConsumableArray\";import _classCallCheck from\"C:\\\\Users\\\\xmark\\\\Desktop\\\\Code\\\\Servers\\\\Qumoc\\\\food-commune\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/classCallCheck\";import _createClass from\"C:\\\\Users\\\\xmark\\\\Desktop\\\\Code\\\\Servers\\\\Qumoc\\\\food-commune\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/createClass\";import _inherits from\"C:\\\\Users\\\\xmark\\\\Desktop\\\\Code\\\\Servers\\\\Qumoc\\\\food-commune\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/inherits\";import _createSuper from\"C:\\\\Users\\\\xmark\\\\Desktop\\\\Code\\\\Servers\\\\Qumoc\\\\food-commune\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/createSuper\";import React,{Component}from\"react\";import{connect}from\"react-redux\";import AddDeal from\"./AddDeal\";import Profile from\"./Profile\";import Buys from\"./Buys\";import Deals from\"./Deals\";import MyGroups from\"./MyGroups\";var mapStateToProps=function mapStateToProps(state){return{user:state.user,token:state.token};};var DashboardView=/*#__PURE__*/function(_Component){_inherits(DashboardView,_Component);var _super=_createSuper(DashboardView);function DashboardView(){var _this;_classCallCheck(this,DashboardView);for(var _len=arguments.length,args=new Array(_len),_key=0;_key<_len;_key++){args[_key]=arguments[_key];}_this=_super.call.apply(_super,[this].concat(args));_this.state={token:null,user:null,data:null,showAddDeal:false,editDeal:null};_this.newDeal=function(payload){insertDeal(_this.props.token,_this.props.user.id,payload).then(function(resolved){console.log(resolved);_this.setState(function(prevState){var Deals=_toConsumableArray(prevState.data.Deals);Deals.push(payload);var data=_objectSpread({},prevState.data,{Deals:Deals});return{data:data};},function(){_this.setState({showAddDeal:false});});}).catch(function(err){console.log(err);});};_this.updateDeal=function(payload){updateDealEdit(_this.props.token,_this.props.user.id,payload).then(function(resolved){console.log(resolved);_this.setState(function(prevState){var Deals=_toConsumableArray(prevState.data.Deals);var deal=Deals.findIndex(function(obj){return obj.id===payload.id;});Deals[deal]=payload;var data=_objectSpread({},prevState.data,{Deals:Deals});return{data:data};},function(){_this.setState({showAddDeal:false});});}).catch(function(err){console.log(err);});};_this.showAddDeal=function(toggle){_this.setState({showAddDeal:_this.state.showAddDeal?false:true,editDeal:null});};_this.editDeal=function(index){_this.setState({editDeal:_this.state.data.Deals[index],showAddDeal:true});};_this.updateProfile=function(payload){updateUserProfile(_this.props.token,_this.props.user.id,payload).then(function(resolved){console.log(resolved);_this.setState(function(prevState){var user=_objectSpread({},prevState.user);var keys=Object.keys(payload);keys.forEach(function(k){user[k]=payload[k];});return{user:user};});}).catch(function(err){console.log(err);});};return _this;}_createClass(DashboardView,[{key:\"componentWillMount\",value:function componentWillMount(){var _this2=this;fetchData(this.props.token,this.props.user.id).then(function(resolved){console.log(resolved);_this2.setState({data:resolved});}).catch(function(err){console.log(err);});}},{key:\"render\",value:function render(){return/*#__PURE__*/React.createElement(React.Fragment,null,/*#__PURE__*/React.createElement(\"div\",{id:\"dashboard\",className:\"row row-border justify-content-center\"},this.state.showAddDeal&&/*#__PURE__*/React.createElement(AddDeal,{editDeal:this.state.editDeal,showAddDeal:this.showAddDeal,user:this.props.user,newDeal:this.newDeal,updateDeal:this.updateDeal}),/*#__PURE__*/React.createElement(\"div\",{id:\"main-content\",className:\"col-sm-12 col-md-10 spartan py-4\"},/*#__PURE__*/React.createElement(\"div\",{className:\"row\"},/*#__PURE__*/React.createElement(\"div\",{id:\"profile-card\",className:\"col-sm-12 col-lg-6 d-flex\"},/*#__PURE__*/React.createElement(Profile,{updateProfile:this.updateProfile})),/*#__PURE__*/React.createElement(\"div\",{id:\"groups-card\",className:\"col-sm-12 col-lg-6 d-flex\"},/*#__PURE__*/React.createElement(MyGroups,{data:this.state.data}))),/*#__PURE__*/React.createElement(\"div\",{className:\"row mt-4\"},/*#__PURE__*/React.createElement(\"div\",{id:\"buys-card\",className:\"col-12\"},/*#__PURE__*/React.createElement(Buys,{data:this.state.data,showAddDeal:this.showAddDeal,editDeal:this.editDeal,user:this.props.user}))))));}}]);return DashboardView;}(Component);export default connect(mapStateToProps)(DashboardView);function fetchData(token,userid){console.log(\"fetching data......\",token,userid);return new Promise(function(resolve,reject){var request={userId:userid};var options={method:\"POST\",headers:new Headers({Authorization:\"Bearer \"+token,\"Content-Type\":\"application/json\"}),body:JSON.stringify({entity:request})};fetch(\"https://qumoc.com/foodcommune/accounts/dashboard\",options).then(function(res){if(res)return res.json();}).then(function(res){if(!res.success){// Return to account detail and display error message\nresolve(res);}else{reject(\"Unable to retrieve data\");}});});}function insertDeal(token,userid,payload){console.log(\"fetching data......\",token,userid);payload.user_id=userid;// Append user_id to payload\nreturn new Promise(function(resolve,reject){var options={method:\"POST\",headers:new Headers({Authorization:\"Bearer \"+token,\"Content-Type\":\"application/json\"}),body:JSON.stringify({entity:payload})};fetch(\"/foodcommune/accounts/insertDeal\",options).then(function(res){return res.json();}).then(function(res){if(res.success){// Return to account detail and display error message\nresolve(res);}else{reject(res);}});});}function updateDealEdit(token,userid,payload){console.log(\"fetching data......\",token,userid);payload.user_id=userid;// Append user_id to payload\nreturn new Promise(function(resolve,reject){var options={method:\"POST\",headers:new Headers({Authorization:\"Bearer \"+token,\"Content-Type\":\"application/json\"}),body:JSON.stringify({entity:payload})};fetch(\"/foodcommune/accounts/updateDeal\",options).then(function(res){return res.json();}).then(function(res){if(res.success){// Return to account detail and display error message\nresolve(res);}else{reject(res);}});});}function updateUserProfile(token,userid,payload){var payloadObj={userId:userid,values:payload};console.log(\"fetching data......\",token,userid);return new Promise(function(resolve,reject){var options={method:\"POST\",headers:new Headers({Authorization:\"Bearer \"+token,\"Content-Type\":\"application/json\"}),body:JSON.stringify({entity:payloadObj})};fetch(\"/foodcommune/accounts/updateUserProfile\",options).then(function(res){return res.json();}).then(function(res){if(res.success){// Return to account detail and display error message\nresolve(res);}else{reject(res);}});});}// {/* <div className=\"row mt-4\">\n//               <div id=\"buys-card\" className=\"col-12\">\n//                 {/* <!-- DEALS --> */}\n//                 <Deals\n//                   showAddDeal={this.showAddDeal}\n//                   data={this.state.data}\n//                   editDeal={this.editDeal}\n//                 />\n//               </div>\n//             </div> */}","map":{"version":3,"sources":["C:/Users/xmark/Desktop/Code/Servers/Qumoc/food-commune/src/components/DashboardView.jsx"],"names":["React","Component","connect","AddDeal","Profile","Buys","Deals","MyGroups","mapStateToProps","state","user","token","DashboardView","data","showAddDeal","editDeal","newDeal","payload","insertDeal","props","id","then","resolved","console","log","setState","prevState","push","catch","err","updateDeal","updateDealEdit","deal","findIndex","obj","toggle","index","updateProfile","updateUserProfile","keys","Object","forEach","k","fetchData","userid","Promise","resolve","reject","request","userId","options","method","headers","Headers","Authorization","body","JSON","stringify","entity","fetch","res","json","success","user_id","payloadObj","values"],"mappings":"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","sourcesContent":["import React, { Component } from \"react\";\r\nimport { connect } from \"react-redux\";\r\nimport AddDeal from \"./AddDeal\";\r\nimport Profile from \"./Profile\";\r\nimport Buys from \"./Buys\";\r\nimport Deals from \"./Deals\";\r\nimport MyGroups from \"./MyGroups\";\r\n\r\nconst mapStateToProps = state => {\r\n  return {\r\n    user: state.user,\r\n    token: state.token\r\n  };\r\n};\r\n\r\nclass DashboardView extends Component {\r\n  state = {\r\n    token: null,\r\n    user: null,\r\n    data: null,\r\n    showAddDeal: false,\r\n    editDeal: null\r\n  };\r\n\r\n  componentWillMount() {\r\n    fetchData(this.props.token, this.props.user.id)\r\n      .then(resolved => {\r\n        console.log(resolved);\r\n        this.setState({ data: resolved });\r\n      })\r\n      .catch(err => {\r\n        console.log(err);\r\n      });\r\n  }\r\n\r\n  newDeal = payload => {\r\n    insertDeal(this.props.token, this.props.user.id, payload)\r\n      .then(resolved => {\r\n        console.log(resolved);\r\n        this.setState(\r\n          prevState => {\r\n            let Deals = [...prevState.data.Deals];\r\n            \r\n            Deals.push(payload);\r\n            let data = { ...prevState.data, Deals: Deals };\r\n            return { data: data };\r\n          },\r\n          () => {\r\n            this.setState({ showAddDeal: false });\r\n          }\r\n        );\r\n      })\r\n      .catch(err => {\r\n        console.log(err);\r\n      });\r\n  };\r\n\r\n  updateDeal = payload => {\r\n    updateDealEdit(this.props.token, this.props.user.id, payload)\r\n      .then(resolved => {\r\n        console.log(resolved);\r\n        this.setState(\r\n          prevState => {\r\n            let Deals = [...prevState.data.Deals];\r\n            let deal = Deals.findIndex(obj => {\r\n              return obj.id === payload.id;\r\n            });\r\n            Deals[deal] = payload;\r\n\r\n            let data = { ...prevState.data, Deals: Deals };\r\n            return { data: data };\r\n          },\r\n          () => {\r\n            this.setState({ showAddDeal: false });\r\n          }\r\n        );\r\n      })\r\n      .catch(err => {\r\n        console.log(err);\r\n      });\r\n  };\r\n\r\n  showAddDeal = toggle => {\r\n    this.setState({\r\n      showAddDeal: this.state.showAddDeal ? false : true,\r\n      editDeal: null\r\n    });\r\n  };\r\n\r\n  editDeal = index => {\r\n    this.setState({\r\n      editDeal: this.state.data.Deals[index],\r\n      showAddDeal: true\r\n    });\r\n  };\r\n\r\n  updateProfile = payload => {\r\n    updateUserProfile(this.props.token, this.props.user.id, payload)\r\n      .then(resolved => {\r\n        console.log(resolved);\r\n        this.setState(prevState => {\r\n          let user = { ...prevState.user };\r\n          let keys = Object.keys(payload);\r\n          keys.forEach(k => {\r\n            user[k] = payload[k];\r\n          });\r\n\r\n          return { user: user };\r\n        });\r\n      })\r\n      .catch(err => {\r\n        console.log(err);\r\n      });\r\n  };\r\n\r\n  render() {\r\n    return (\r\n      <React.Fragment>\r\n        {/* Dashboard */}\r\n        <div id=\"dashboard\" className=\"row row-border justify-content-center\">\r\n          {/* Add Deal */}\r\n          {this.state.showAddDeal && (\r\n            <AddDeal\r\n              editDeal={this.state.editDeal}\r\n              showAddDeal={this.showAddDeal}\r\n              user={this.props.user}\r\n              newDeal={this.newDeal}\r\n              updateDeal={this.updateDeal}\r\n            />\r\n          )}\r\n          <div id=\"main-content\" className=\"col-sm-12 col-md-10 spartan py-4\">\r\n            <div className=\"row\">\r\n              <div id=\"profile-card\" className=\"col-sm-12 col-lg-6 d-flex\">\r\n                {/* <!-- PROFILE --> */}\r\n\r\n                <Profile updateProfile={this.updateProfile} />\r\n              </div>\r\n\r\n              <div id=\"groups-card\" className=\"col-sm-12 col-lg-6 d-flex\">\r\n                {/* <!-- GROUPS --> */}\r\n                <MyGroups data={this.state.data} />\r\n              </div>\r\n            </div>\r\n            <div className=\"row mt-4\">\r\n              <div id=\"buys-card\" className=\"col-12\">\r\n                {/* <!-- BUYS --> */}\r\n                <Buys\r\n                  data={this.state.data}\r\n                  showAddDeal={this.showAddDeal}\r\n                  editDeal={this.editDeal}\r\n                  user={this.props.user}\r\n                />\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </React.Fragment>\r\n    );\r\n  }\r\n}\r\n\r\nexport default connect(mapStateToProps)(DashboardView);\r\n\r\nfunction fetchData(token, userid) {\r\n  console.log(\"fetching data......\", token, userid);\r\n  return new Promise((resolve, reject) => {\r\n    let request = { userId: userid };\r\n    let options = {\r\n      method: \"POST\",\r\n      headers: new Headers({\r\n        Authorization: \"Bearer \" + token,\r\n        \"Content-Type\": \"application/json\"\r\n      }),\r\n      body: JSON.stringify({\r\n        entity: request\r\n      })\r\n    };\r\n    fetch(\"https://qumoc.com/foodcommune/accounts/dashboard\", options)\r\n      .then(res => {\r\n        if (res) return res.json();\r\n      })\r\n      .then(res => {\r\n        if (!res.success) {\r\n          // Return to account detail and display error message\r\n          resolve(res);\r\n        } else {\r\n          reject(\"Unable to retrieve data\");\r\n        }\r\n      });\r\n  });\r\n}\r\n\r\nfunction insertDeal(token, userid, payload) {\r\n  console.log(\"fetching data......\", token, userid);\r\n  payload.user_id = userid; // Append user_id to payload\r\n  return new Promise((resolve, reject) => {\r\n    let options = {\r\n      method: \"POST\",\r\n      headers: new Headers({\r\n        Authorization: \"Bearer \" + token,\r\n        \"Content-Type\": \"application/json\"\r\n      }),\r\n      body: JSON.stringify({\r\n        entity: payload\r\n      })\r\n    };\r\n    fetch(\"/foodcommune/accounts/insertDeal\", options)\r\n      .then(res => {\r\n        return res.json();\r\n      })\r\n      .then(res => {\r\n        if (res.success) {\r\n          // Return to account detail and display error message\r\n          resolve(res);\r\n        } else {\r\n          reject(res);\r\n        }\r\n      });\r\n  });\r\n}\r\n\r\nfunction updateDealEdit(token, userid, payload) {\r\n  console.log(\"fetching data......\", token, userid);\r\n  payload.user_id = userid; // Append user_id to payload\r\n  return new Promise((resolve, reject) => {\r\n    let options = {\r\n      method: \"POST\",\r\n      headers: new Headers({\r\n        Authorization: \"Bearer \" + token,\r\n        \"Content-Type\": \"application/json\"\r\n      }),\r\n      body: JSON.stringify({\r\n        entity: payload\r\n      })\r\n    };\r\n    fetch(\"/foodcommune/accounts/updateDeal\", options)\r\n      .then(res => {\r\n        return res.json();\r\n      })\r\n      .then(res => {\r\n        if (res.success) {\r\n          // Return to account detail and display error message\r\n          resolve(res);\r\n        } else {\r\n          reject(res);\r\n        }\r\n      });\r\n  });\r\n}\r\n\r\nfunction updateUserProfile(token, userid, payload) {\r\n  let payloadObj = { userId: userid, values: payload };\r\n  console.log(\"fetching data......\", token, userid);\r\n  return new Promise((resolve, reject) => {\r\n    let options = {\r\n      method: \"POST\",\r\n      headers: new Headers({\r\n        Authorization: \"Bearer \" + token,\r\n        \"Content-Type\": \"application/json\"\r\n      }),\r\n      body: JSON.stringify({\r\n        entity: payloadObj\r\n      })\r\n    };\r\n    fetch(\"/foodcommune/accounts/updateUserProfile\", options)\r\n      .then(res => {\r\n        return res.json();\r\n      })\r\n      .then(res => {\r\n        if (res.success) {\r\n          // Return to account detail and display error message\r\n          resolve(res);\r\n        } else {\r\n          reject(res);\r\n        }\r\n      });\r\n  });\r\n}\r\n\r\n// {/* <div className=\"row mt-4\">\r\n//               <div id=\"buys-card\" className=\"col-12\">\r\n//                 {/* <!-- DEALS --> */}\r\n//                 <Deals\r\n//                   showAddDeal={this.showAddDeal}\r\n//                   data={this.state.data}\r\n//                   editDeal={this.editDeal}\r\n//                 />\r\n//               </div>\r\n//             </div> */}\r\n"]},"metadata":{},"sourceType":"module"}